# Tuntimuistiinpanot, vierailijaluento 5 

Vierailija Mika Rautio Poplatekiltä, työnä koodia ja tietoturvaa ja juristiikkaa

  - Mikäli maksat korteilla, todennäköisesti kulkenut Poplatekin kautta liikenne
  - Opiskelee HH:ssa liiketaloutta
  - Miten oikeasti organisaatioissa tapahtuu pentestiä tehdessä, yritysnäkökulma
 
Mikä yleisin tapa murtautua järjestelmiin

  - Verizon Data Breach Investigation raportti vuosittain
    - Social engineering
    - Stolen poor credentials (<-- Näitä on murrettu jo kolmella ohjelmalla kurssilla, JtR, Medusa ja Ffuf)
    - Systems are not up-to-date
    - Systems are accessible from the Internet (<-- Tiedustelussa huomattiin tämän oleellisuus miten paljon turhia palveluja ja portteja auki teoriassa ja käytännössä koneissa)
  
 Miksi testataan? 
  - Toki turvallisuuden parantaminen,
  - ...mutta monesti liiketoimintaluvan menettäminen jos ei harjoita esim. kerran vuodessa (alakohtaista)

PCI DSS 
Payment Card Industry Data Security Standard
  - Kaikki yritykset ja järjestelmät jotka käsittelee, välittää tai tallentaa korttidataa joutuu noudattaa PCI DSS
  - Pitää olla metodologia pentestingiin 11.3
  - Mitä pitää tehdä
    - External pentest vähintään vuosittain 11.3.1
      - Yritys päästä tuotantojärjestelmiin 
    - Internal pentest vähintään vuossitain 11.3.2
      - Tehdään yleensä vain testijärjestelmien puolella
      - Yleensä ei sisäverkkopääsyä tuotantojärjestelmiin
    - Löydettyjen haavoittuvuuksien korjaaminen ja uusi testaus korjausten varmistamiseksi 11.3.3
    - 11.3.4 vuosittainen testaus segmentaatio metodien toimivuuden varmistaminen
      - Segmentaatio, esim. palomuuri järjestelmien välissä, järjestelmien jakaminen osiin
      - Sekä internal että external liittyy

Pentest prosessi
  - Vaatimukset
  - Mitkä järjestelmät? 
    - Yleensä kriittisimmät
    - Esim. julkinen verkkosivu missä vain julkista dataa ei kovin kriittinen
    - Mutta yrityksen tietokanta missä potilasdataa hyvin kriittinen
  - Kuka tekee pentestingin? 
    - Ketä löytyy esim. Suomesta? F-Secure & Nixu esim.
    - Katsotaan minkä tasoisia testaajia tulossa. 
  - Laajuus ja aikataulu
    - Laajuuden suhteen kannattaa olla kriittinen, varmistaminen onko testin tilaajalla lupaa järjestelmiin jne. 
    - Pilvipalvelut saattavat reagoida pentestaukseen ja sulkea palvelut 
  - Kriittisten haavoittuvuuksien korjaaminen ja uusi testaus
    - Joskus korjaukset eivät mene oikein tai ole riittäviä
  - Testiraporttien tekeminen tilaajalle
    - Mitä tehtiin, kuinka tehtiin, milloin tehtiin, mitkä olivat löydökset?

Miksi inhouse pentestingiä?
  - Aika, joskus ei ole aikaa odottaa 2kk
  - Paljon järjestelmiä, pakko tehdä omaa pentestausta
  - AWS esim. korjasi yli 8kb http request bodyt, hakkerit päässeet läpi yli 8kb
    - AWS:llä on omat pentest ohjeet jotka kertovat mitä saa testata
      - Varmista tarvittaessa ja tallenna vastaukset, jos ASPAsta tulee lupa se on aina turvallisempaa
  - Enemmän aikaa testata
  - Ketterämpää
  - Organisaatiospesifit vaatimukset, henkilöt voivat erikoistua
  - Silti kannattaa käyttää useita testaajia ja ulkopuolisia testaajia

Mitä pentestaajalta odotetaan?
  - Oppimishalu
    - Uudet järjestelmät, vieraat ympäristöt
  - Sertifikointi
    - CEH (ei hyvämaineinen, ei riitä yksin mutta hyvä lisä)
    - OSCP (kurssin laajuus ei riitä tähän)
  - Todistetut taidot
    - Opiskeluympäristöt
      - Hack the box (oppii oikeasti murtautumaan)
    - Bug bounties (vaatii erittäin kovaa ammattitaitoa ja aikaa, ei aloittelijalle suositeltava)
      - Aina scope ja rajoituksia esim. automatisoitujen työkalujen käytössä
      - Hackerone 
      - Intigriti
      - Suomessa Tilastokeskuksella bug bounteja
      - Bug bountyssa olevat koneet kovennettuja moniin normaaleihin palveluihin verrattuna 
      - Keskity yhteen palveluun ja organisaatioon jos päädyt tekemään 
      - Opettavainen kokemus kuitenkin 
    - Raportoidut haavoittuvuudet
    - Työkokemus
  - Pentesterit käyvät mm. läpi konffitiedostoja luvan kanssa (white box testing vs. normaali musta laatikko testaus)
  - Valtava arsenaali työkaluja valmiina, ohjelmointi ei ole välttämätöntä pentestaajalle
  - Sen sijaan verkkoprotokollat ja niiden ymmärtäminen oleellista
  - HelSec tapahtumat alan tekijöille, Disobey tapahtuma helmikuussa
 
 Suositut työkalut
  - Nmap verkkoskannaukseen
  - Wireshark - Kaappaa ja analysoi verkkoliikennettä
  - Metasploit - All-in-one pentest framework
  - [Burp Suite](https://www.kali.org/tools/burpsuite/) - Verkkoapplikaatio pentest framework 
    - OWASP ZAP ilmaisversio korvike Burp Suitelle

"Tärkein" työkalu kuitenkin
  - [https://www.ssllabs.com/ssltest](https://www.ssllabs.com/ssltest)
  - Aina voi antaa kommentteja kryptografisista protokollista 
  - Kukaan ei niitä kuitenkaan koskaan korjaa ja raportit menevät roskikseen :-)
    - Ellei mukaan liitä demoa :-) 
  - Jokainen valtio voi korkata TLS yhteyden
    - Mutta valtiollisilta hyökkäyksiltä voi suojautua pinnaamalla TLS-sertifikaatin palveluun rajoittamalla CA truth storea
    - Samaa tekniikkaa voi käyttää myös muissa palveluissa 
    - Isot tekijät käyttävät CA palvelujen korkkaamista hyökkäyksissä
 
 Mitä pentestaajat ovat löytäneet? 
  - Tyypillisiä haavoittuvuuksia, OWASP TOP 10 
    - Mutta hyökkäyksen jatkaminen voi silti olla hankalaa kun järjestelmät kovennettuja
  - Katso myös yleisimpien haavoittuvuuksien ulkopuolelta
  - Jos haavoittuvuuksia ei löydy voi pyytää palomuurisääntöjen keventämistä tms. 
  - Oma palomuurisääntö jokaisella mikropalvelulla auttaa segmentoimaan ja koventamaan järjestelmää
    - Yrityksen sisäverkkoa pidetään yhtä turvallisena kuin Internettiä 
 
  - Pahamaineinen suomalainen finseiska
  - AWS IDS GuardDuty 
  - Siemi / EDR / Sokki ratkaisuja 
  - security operations (iso kasa logeja ja yrittävät löytää ongelmia)
    - Entry level hommaa alalle soc 1 monesti
    - Siemi ja EDR työkaluja mitä näissä hommissa käytetään, uhkadataa analysoidaan 
    - Pluk? Grey log / ELK 
  - HelSec videot marraskuussa 
  - Hinta pentestille n. 1k päivä 
  - Pikku järjestelmä ehkä alle 10k
  - Iso yli 10k 
  - FireEye vuoto 

# Tuntiopetus vierailun jälkeen: OWASP ZAP 

  - Hakupyyntöjen käsittely oleellinen ominaisuus
  - Oikealla näppäimellä saa auki hakupyyntöjen manipuloinnin
  - Kun käynnistyy, avaa proxyn
  - FoxyProxyyn voi tehdä patternin, ja jos tekee pentestiä nettiin kannattaa se sinne asettaa. 
  - HTTPS salaa kuitenkin liikenteen
  - Tools -> Options -> Dynamic SSL Certificate -> Save -> 
  - FF: about:prefences -> Certificates -> View Certificates -> Import -> Trust for websites
  - Asetukset FF:llä tai FoxyProxyllä 
  - Testaa poistamalla SSL luotetuista ja lataa sivu uudestaan https-sivu
  - Sellainen on välimiesproxy, Mittenproxy (kategoria mutta myös palvelu) vaihtoehto 
  - Alerts välilehdellä näkyy vinkkejä haavoittuvuuksista 
  - CRFS protection selaimissa päällä 
  - Oikealla napilla Sites-puussa ja Break.. voi kohdistaa breakpointin

Pitää saavuttaa tietoylivoima, siihen OWASP ZAP. 
  - HUD sivuilla ZAPin kanssa
  - Napin painalluksella piilotetut kentät ja paljon muuta
  - Menee ZAP:ssa päälle Tools -> Options -> HUD -> Enable ..
  - Tehdään tutoriaali
    - Saa päälle ZAP Toolbarin vihreästä pylpyrästä ja samasta pois

Jatkoa varten
  - Hack the box kannattaa aloittaa

# Edellisten tehtävien läpikäynti

  - SYN scan (ex. stealth scan) ja Connect scan ihan yhtä jäljitettäviä
  - SYN scan on nykyisin melkein hälyttävämpi 
  - SYN = synchronize (Heippa, haluan jutella) 
  - RST = Reset, tyly tapa katkaista
  - FIN = normaali tapa katkaista 

# HackTheBox
  
  - Aloitetaan Hack the Box
  - Hack the boxin oma tutoriaali lab accessiin: [https://help.hackthebox.com/en/articles/5185687-gs-introduction-to-lab-access](https://help.hackthebox.com/en/articles/5185687-gs-introduction-to-lab-access)
  - Ohjeita aloittamiseen eri OS:llä: [https://www.youtube.com/channel/UCG-48Ki-b6W_siaUkukJOSw] 
  - Vaatimukset:
    - Hack The Box tili
    - Latest version of OpenVPN 
    - Internetyhteys
