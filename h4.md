# H4 Tiedustelua
Aktiivinen tiedustelu (Active Recon)

## Sisällysluettelo 
* TOC
{:toc}

# z) Tiivistä 

## € Santos et al: The Art of Hacking
[https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/)

  - Onnistunut tiedustelu on vaatimus muiden hyökkäyksen vaiheiden (Mitre Att&ck taktiikoiden) toteuttamiseen
  - Tiedusteluun liittyy enumeraatio, arvojoukon järjestetty listaaminen (ts. kohteen tietojen kerääminen ja järjestely)
    - Enumeraatio cheat-sheet pentestaukseen: [https://hausec.com/pentesting-cheatsheet/#\_Toc475368976](https://hausec.com/pentesting-cheatsheet/#_Toc475368976)
  - Aktiivinen tiedustelu aka skannausvaihe jättää jälkiä logeihin mutta se ei tarkoita että niitä välttämättä huomattaisiin
  - Metodologia auttaa oikeisiin kohteisiin järjestelmiin ja palveluihin keskittymisessä
    - Passiivisessa vaiheessa löydettyjen porttien porttiskannaus
      - Nmap, monipuolisin, käytetyin ja stabiilein työkalu [https://nmap.org](https://nmap.org)
      - Masscan, nopein skanneri, jos skannattavaa riittää
      - Udprpotoscanner UDP-porttien skannaukseen 
    - Verkkopalveluiden arviointi
    - Haavoittuvuusskannaus joka tulisi tehdä tiedusteluvaiheen lopuksi
      - Äänekäs vaihe joka hälyttää IDS:n (Intrusion Detection System) jos sellaisia käytössä
  - 
  
## Lyon 2009: Nmap Network Scanning: Chapter 1. Getting Started with Nmap
[https://nmap.org/book/nmap-overview-and-demos.html](https://nmap.org/book/nmap-overview-and-demos.html)

## Lyon 2009: Nmap Network Scanning: Chapter 15
[https://nmap.org/book/man.html](https://nmap.org/book/man.html)

# a) - m) Tee ja raportoi: Nmap
_Miten nmap toimii? Tee nmapilla seuraavat testit, sieppaa liikenne snifferillä (wireshark) ja analysoi tulokset. 
Tee testit mahdollisimman suppeasti, jotta analysointi on helpompaa. 
Esimerkiksi skannaa vain yksi portti yhdestä koneesta, jos ominaisuuden esittely ei hyöydy laajemmasta skannauksesta. 
Selitä myös, miksi nmap lähettää tuollaisia paketteja. 
Käytä nmap:ia normaalisti sudo:n kanssa. 
Kannattaa tietysti aloittaa lukemalla man-sivulta tai Nmap Reference Guidesta, 
mitä noilla toiminnoilla on ylipäänsä tarkoitus tehdä. 
Porttiskannaa ainoastaan omaa konetta omassa verkossa ja harjoitusmaaleja._

## a) nmap TCP connect scan -sT

## b) nmap TCP SYN scan -sS

## c) nmap ping sweep -sn

## d) nmap don't ping -Pn 

## e) nmap version detection -sV
_esimerkki yhdestä palvelusta yhdessä portissa riittää_

## f) nmap porttien valinta -p1-100, --top-ports 5, -p-

## g) nmap ip-osoitteiden valinta
_luettelo, verkkomaskilla 10.10.10.0/24, alku- ja loppuosoitteella 10.10.10.100-130 
(ipcalc auttaa ymmärtämään, miten verkkomaskia tulkitaan)_

## h) nmap output files -oA foo
_Mihin kukin tiedostotyyppi sopii?_

## i) nmap version scanning -sV

## j) nmap OS fingerprinting, version detection, scripts, traceroute, -A

## k) nmap ajonaikaiset toiminnot
_(man nmap: runtime interaction): verbosity v/V, help ?, packet tracing p/P, status s (ja moni muu nappi)_

## l) sudo nmap 
_Miten nmap toiminta eroaa, jos sitä ajaa ilman sudoa? Suorita ja analysoi esimerkki._

## m) nmap vertailu
_vertaile -sV vs -A kestoa (ja lähetetyn datan määrää jos osaat; time, nethogs, wireshark). 
Käytä harjoitusmaalina metasploitable2._

## d)\[sic\] Ninjojen tapaan 
_Piiloutuuko nmap-skannaus hyvin palvelimelta? Vinkkejä: Asenna Apache. 
Aja nmap-versioskannaus -sV omaan paikalliseen weppipalvelimeen. 
Etsi Apachen lokista tätä koskevat rivit. 
Wiresharkissa "http" on kätevä filtteri, se tulee siihen yläreunan "Apply a display filter..." -kenttään. 
Nmap-ajon aikana p laittaa packet tracing päälle. 
Vapaaehtoinen lisäkohta: jääkö Apachen lokiin jokin todiste nmap-versioskannauksesta?_

# e) - g)\[sic\] Tee ja raportoi: UDP-skannaus

## e)\[sic\] Tavallisimmat/kiinnostavimmat UDP-palvelut
_Mitkä ovat tavallisimmat tai kiinnostavimmat palvelut, joita UDP-skannauksella voisi löytää? (
tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)_

## f)\[sic\] UDP-skannauksen hankaluus ja epäluotettavuus
_Miksi UDP-skannaus on hankalaa ja epäluotettavaa? Miksi UDP-skannauksen kanssa kannattaa käyttää --reason flagia? 
(tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)_

# h) - j)\[sic\] Tee ja raportoi: muita aktiivisen tiedustelun työkaluja

## h)\[sic\] fuff 
_hakemistojen kokeilu riittää_

## i)\[sic\] nikto

## j)\[sic\] Pizza fantasia
_jokin valitsemasi tiedustelutyökalu, esimerkiksi EyeWitness, wpscan, openvas tai jokin muu._
