[<-- Takaisin etusivulle](index.md)

# h3: Attaaack!
Kurssisivu ja tehtävät: [https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h3-attaaack](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h3-attaaack)

* TOC
{:toc}

## x) Lue/katso/kuuntele ja tiivistä
*Tässä alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen ja tiivistelmä riittää). Tiivistä ranskalaisilla viivoilla.*

### € Percival & Samancioglu 2020: The Complete Ethical Hacking Course: Chapter 21: Cross Site Scripting
*[Chapter 21: Cross Site Scripting](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/) (7 videota, noin 25 min)*
 - XSS tarkoittaa Cross-Site Scriptingiä. 
 - XSS ei tarvitse erillistä ohjelmaa.
 - Syöttää injektion palvelimelle joka ajetaan käyttäjäpäässä, uhrin selaimessa. 
 - Syöttökentässä voidaan lähettää skripti URL:ssa. 
    - Tarkoittaa että syöttökentässä käytetään GET methodia. 
    - Tämä häkätty URL voidaan sitten lähettää kenelle tahansa joka linkkiä klikatessaan ajaa URL:ssa olevan skriptin. 
 - Voidaan myös tallettaa skripti sivulle POST methodilla syöttökentän kautta jos sivu tallettaa tietoja. 
    - Kuka tahansa sivulle tulija automaattisesti ajaa skriptin.
    - Elementin maxlength voi muokkaa dev toolseilla ja syöttää pidempiä skriptejä kuin lähdekoodi sallisi. 
 - Yhdistettynä muihin työkaluihin kuten BEEF voi kerätä haavottuneita koneita talteen jatkohyökkäystä varten. 
 - Selaimen asetuksissa voi kytkeä sivujen JS pois päältä. 


### OWASP 10 2017 [PDF](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf): A2 Broken Authentication; A3 Sensitive Data Exposure; A7 Cross Site Scripting
*Poimi kustakin kolmesta hyökkäyksestä, miten ne käytännössä tehdään*

### MITRE 2021: [ATT&CK Enterprise Matrix](https://attack.mitre.org/matrices/enterprise/)
*Selitä tiivistelmässä käsitteet tactic, technique, procedure. Selitä kukin taktiikka (tactic) ja anna kustakin taktiikasta esimerkkitekniikka (technique tai subtechnique)*

## z) Cross Site Story
*Kirjoita kuvitteellinen esimerkki XSS-hyökkäyksestä. Tee mahdollisimman yksinkertainen esimerkki. Voit vaikkapa ottaa haltuun weppisivun ylläpitäjän oikeudet viemällä keksin. Tässä alakohdassa ei tarvitse tehdä mitään tietokoneella, pelkkä tarina riittää. Tarkoituksena on ymmärtää XSS-hyökkäyksen kokonaisuus ennen sormiharjoituksia. Voi halutessasi myös piirtää itse kaavion / sarjakuvan.*

*Tee selväksi ja erottele
  *- Mitä hyökkääjä tekee
  *- Mitä kohdehenkilö tekee
  *- Mitä sivua / palvelinta kohdehenkilö surffailee
  *- Missä JavaScriptit ajetaan
  *- Miten keksi päätyy hyökkääjälle
  *- Miten hyökkääjä hyödyntää keksiä?
  *- Mitä hyökkääjä pääsee tekemään (mikä ei onnistuisi ilman hyökkäystä)?

## Tee ja raportoi

### a) Vuohen uudet seikkailut
*Ratkaise WebGoatista tehtävät*

#### A2 Broken authentication:
##### Authentication bypasses: 2 2FA Password Reset

#### A3 Sensitive data exposure
##### Insecure Login: 2 Let's try

#### A7 Cross Site Scripting (XSS): Cross site scripting
##### 2 What is XSS?
##### 7 Try It! Reflected XSS

#### A8:2013 Request Forgeries:
Cross-Site Request Forgeries
##### 3 "Basic Get CSRF Exercise"
##### 4 "Post a review on someone else’s behalf".*

### b) Attakin alatekniikat
*Demonstroi kaksi (2) alatekniikkaa (subtechnique) ATT&CK kehikosta. Tässä pitää siis käyttää näitä käytännössä johonkin harjoitusmaaliin. Voit käyttää haluamiasi valmiita työkaluja tai koodata / skriptata itse. Voit valita valmiin harjoitusmaalin tai tehdä sen itse. __Muista, että myös tiedustelussa pitää noudattaa lakia, etiikkaa, rajauksia (scope) ja hyviä tapoja.__*

## Kommentit harjoituksia edeltävältä tunnilta
  - Att&ck: [https://attack.mitre.org](https://attack.mitre.org)
    - Taktiikat on mitä tavoitellaan (yläkäsite)
    - Tekniikka taktiikan saavuttamiseksi tarkoitettu spesifi toimintatapa
    - Prosedure miten hyökkäystä käytetty tosimaailmassa
  - Pyramid of pain: [https://attackiq.com/2019/06/26/emulating-attacker-activities-and-the-pyramid-of-pain/](https://attackiq.com/2019/06/26/emulating-attacker-activities-and-the-pyramid-of-pain/)

### Tehtävä harjoituksia edeltävällä tunnilla lounastunnin ohessa tehtäväksi: t45a - 
*Attaaack! Esittele valittu ATT&CK tekniikka.
Selitä mihin taktiikkaan se liittyy. Anna esimerkki proseduurista, jossa sitä on käytetty. 
Esittele tekniikka siten, että sitä pystyy soveltamaan käytännössä. Demosta plussaa, jos aikaa jää yli. 
Tero valitsee taktiikan, jonka sisältä voit itse valita tekniikan.*

#### Taktiikka: Lateral movement - siirtyminen kohdeympäristössä sivuttain
  - Lateral movement: 9 techniques: Tekniikoissa alakohtia - esimerkiksi riittää yksi alakohta
    - Hyökkääjä pyrkii liikkuman ympäristössä sisään järjestelmistiin ja verkkoihin tai hallitsemaan niitä. 
    - Yleensä hyökkääjä kartoittaa verkkoa kohteiden löytämiseksi ja niihin tunkeutumiseksi. 
    - Yleensä tavoitteen saavuttamiseksi pitää pivotoida useiden järjestelmien ja tilien halki. 
    - Hyökkääjä voi asentaa omia etähallintatyökalujaan taktiikassa tai käyttää legitiimejä kredentiaaleja kohdeverkossa ja järjestelmissä.
  - Tekniikoita: Mielenkiintoisen kuulosia tekniikoita lateraalin liikkeen osuudessa ja alkutunnelmat:
    - Internal Spearphishing - Keihäskalastus on mielestäni yksi phishingin alalaji ja internal spearphishing varmaankin organisaation sisäistä kohdistettua kalastelua.
    - Remote Service Session Hijacking - Etäpalvelun session kaappaus, hmmh, vaikuttaa mielenkiintoiselta mutta... 
    - Software Deployment Tools - Ei niin mielenkiintonen kun moni muu mutta kehittäjälle tämä vaikuttaa oleelliselta.
    - Replication Through Removable Media - Eli varmaan tiedostoja jotka voi poistaa mutta hyökkääjä jää koneelle. 

#### Tekniikka: [T1072](https://attack.mitre.org/techniques/T1072/) - Software Deployment Tools
  - Hyökkääjä voi saavuttaa pääsyn kolmannen osapuolen ohjelmistojen kautta jotka on asennettu organisaation verkkoon.
    - Näitä voi olla hallinta-, monitorointi- ja deployment-järjestelmät.
  - Näiden avulla päästään liikkumaan verkossa. Voivat olla käytössä hallintasyistä käytössä verkossa. 
    - Esimerkkeinä annettu SCCM, HBSS, Altiris. [https://en.wikipedia.org/wiki/Altiris](https://en.wikipedia.org/wiki/Altiris)
 
#### Proseduuri: ID: G0040, Name: APT32 
  - APT32 hyökkäsi McAfee ePO:ssa ja jakoi haittaohjelmistoa ohjelmistona. 

*APT32 ran legitimately-signed executables from Symantec and McAfee which load a malicious [DLL](https://en.wikipedia.org/wiki/Dynamic-link_library). The group also side-loads its backdoor by dropping a library and a legitimate, signed executable (AcroTranscoder).*

